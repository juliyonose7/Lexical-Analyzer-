name: CI

on:
  push:
    branches: ["main", "develop", "feature/**", "fix/**", "hotfix/**", "release/**"]
  pull_request:
    branches: ["main", "develop"]

jobs:
  build-and-validate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "21"

      - name: Download JFlex
        run: |
          curl -sSL -o jflex.jar https://repo1.maven.org/maven2/de/jflex/jflex/1.9.1/jflex-1.9.1.jar
          curl -sSL -o java-cup-runtime.jar https://repo1.maven.org/maven2/com/github/vbmacher/java-cup-runtime/11b-20160615/java-cup-runtime-11b-20160615.jar

      - name: Generate lexer
        run: |
          java -cp "jflex.jar:java-cup-runtime.jar" jflex.Main -d ./src ./Lexer.flex

      - name: Compile Java sources
        run: |
          mkdir -p out
          javac -d ./out ./src/*.java

      - name: Smoke test
        run: |
          java -cp ./out Main ./ejemplo.txt

      - name: Upload compiled output
        uses: actions/upload-artifact@v4
        with:
          name: lexer-build
          path: |
            out/
            src/Lexer.java
